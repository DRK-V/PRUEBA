---
import Layout from '../layouts/Layout.astro';
import Download_admin from '../components/download_admin';
import Sidebar from '../components/Sidebar';
---

<Layout title="Tabla de Datos">
  <div id="app-container" class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside>
      <Sidebar client:load />
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-auto">
      <!-- Contenido principal que se mostrará solo con token válido -->
      <div id="data-content" class="hidden container mx-auto p-6">
        <h1 class="text-2xl font-bold mb-6">Tabla de Registros</h1>
        <Download_admin client:load />
      </div>

      <!-- Mensaje de error que se mostrará si no hay token -->
      <div id="error-message" class="flex justify-center items-center h-screen text-red-600 text-2xl font-semibold">
        <p>No tienes permisos para acceder a esta página. Por favor, inicia sesión.</p>
      </div>
    </main>
  </div>

  <script>
    // Solo se ejecuta en el cliente
    if (typeof window !== 'undefined') {
      const token = localStorage.getItem('token');
      const appContainer = document.getElementById('app-container');
      const errorMessage = document.getElementById('error-message');
      const dataContent = document.getElementById('data-content');

      // Verificamos si los elementos existen antes de intentar acceder a sus propiedades
      if (appContainer && errorMessage && dataContent) {
        if (!token) {
          // Si no hay token, mostramos el mensaje de error y ocultamos el contenido
          appContainer.style.display = 'none';
          errorMessage.style.display = 'flex';
        } else {
          // Si hay token, mostramos el contenido y ocultamos el mensaje de error
          errorMessage.style.display = 'none';
          dataContent.style.display = 'block';
        }
      } else {
        console.error('Algunos de los elementos no se encontraron en el DOM');
      }
    }
  </script>
</Layout>

<style>
  :global(body) {
    margin: 0;
    padding: 0;
  }
</style>

---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Login">
  <div class="flex h-screen">
    <div class="flex-1 relative">
      <img src="../../public/images/descarga (1).png" alt="Imagen de fondo" class="w-full h-full object-cover" />
      <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-center text-white text-center p-5">
        <h1 class="text-4xl font-bold mb-4">texto</h1>
        <p class="text-xl">texto 2</p>
      </div>
    </div>
    <div class="flex-1 bg-white flex flex-col justify-center items-center p-10">
      <img src="../../public/images/descarga (1).png" alt="Logo" class="mb-8" />
      <h2 class="text-2xl font-semibold mb-6">INICIAR SESION</h2>
      <form id="loginForm" class="w-full max-w-sm">
        <div class="mb-4">
          <label for="correo" class="sr-only">Correo</label>
          <input type="email" id="correo" placeholder="Correo" required class="w-full p-2 border border-gray-300 rounded" />
        </div>
        <div class="mb-4">
          <label for="contraseña" class="sr-only">Contraseña</label>
          <input type="password" id="contraseña" placeholder="Contraseña" required class="w-full p-2 border border-gray-300 rounded" />
        </div>
        <div id="errorMessage" class="text-red-600 mb-4 text-center"></div>
        <div class="text-right mb-4">
          <a href="/forgot" class="text-sm text-blue-600 hover:underline">¿Olvidaste tu contraseña?</a>
        </div>
        <button type="submit" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700 transition duration-300">
          Iniciar sesión
        </button>
      </form>
    </div>
  </div>

  <script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const correo = document.getElementById('correo').value;
      const contraseña = document.getElementById('contraseña').value;
      const errorMessage = document.getElementById('errorMessage');
  
      try {
        const response = await fetch('http://localhost:3000/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ correo, contraseña })
        });
  
        const data = await response.json();
  
        if (data.token) {
          // Almacenar el token, id, nombre y correo en el localStorage
          localStorage.setItem('token', data.token);
          localStorage.setItem('userId', data.user.id);
          localStorage.setItem('userName', data.user.nombre); // Guardar el nombre del usuario
          localStorage.setItem('userEmail', data.user.correo); // Guardar el correo del usuario
  
          // Redirigir a /dashboard
          window.location.href = '/dashboard';
  
          // Imprimir en consola los datos del login
          console.log('Login exitoso:', data.message);
          console.log('Usuario:', data.user);
          console.log('Token:', data.token);
        } else {
          errorMessage.textContent = 'Error en el inicio de sesión';
        }
      } catch (error) {
        errorMessage.textContent = 'No se pudo conectar al servidor';
        console.error('Login error:', error);
      }
    });
  </script>
  
</Layout>
